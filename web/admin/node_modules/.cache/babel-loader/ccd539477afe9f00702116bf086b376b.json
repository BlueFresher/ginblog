{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Url } from '../../plugin/http';\nexport default {\n  props: ['id'],\n  data() {\n    return {\n      artInfo: {\n        id: 0,\n        title: '',\n        cid: undefined,\n        desc: '',\n        content: '',\n        imf: ''\n      },\n      CateList: [],\n      upUrl: Url + '/upload',\n      headers: {},\n      fileList: [],\n      artInfoRules: {\n        title: [{\n          required: true,\n          message: \"请输入文章标题\",\n          trigger: 'blur'\n        }],\n        cide: [{\n          required: true,\n          message: \"请输入文章分类\",\n          trigger: 'blur'\n        }],\n        desc: [{\n          required: true,\n          message: \"请输入文章描述\",\n          trigger: 'blur'\n        }, {\n          max: 120,\n          message: '最多可写120个字符',\n          trigger: 'change'\n        }],\n        img: [{\n          required: true,\n          message: \"请选择图片\",\n          trigger: 'blur'\n        }],\n        content: [{\n          required: true,\n          message: \"请输入文章内容\",\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.getCateList();\n    this.headers = {\n      Authorization: `Bearer ${window.sessionStorage.getItem('token')}`\n    };\n    if (this.id) {\n      this.getArticleInfo(this.id);\n    }\n  },\n  methods: {\n    // 查询文章信息\n    async getArticleInfo(id) {\n      const {\n        data: res\n      } = await this.$http.get(`article/info/${id}`);\n      if (res.status != 200) return this.$message.error(res.message);\n      this.artInfo = res.data;\n      this.artInfo.id = res.data.ID;\n    },\n    // 查询分类列表\n    async getCateList() {\n      const {\n        data: res\n      } = await this.$http.get('category');\n      console.log(res);\n      if (res.status != 200) return this.$message.error(res.message);\n      this.CateList = res.data;\n    },\n    // 选择分类\n    cateChange(value) {\n      this.artInfo.cid = value;\n    },\n    // 上传图片\n    upChange(info) {\n      if (info.file.status !== 'uploading') {\n        // console.log(info.file, info.fileList);\n      }\n      if (info.file.status === 'done') {\n        this.$message.success(`图片上传成功`);\n        const imgUrl = info.file.response.Url;\n        this.artInfo.img = imgUrl;\n      } else if (info.file.status === 'error') {\n        this.$message.error(`图片上传失败`);\n      }\n    },\n    // 提交或更新文章\n    artOk(id) {\n      this.$refs.artInfoRef.validate(async valid => {\n        if (id == 0) {\n          const {\n            data: res\n          } = await this.$http.post('article/add', this.artInfo);\n          if (res.status != 200) return this.$message.error(res.message);\n          this.$message.success('添加文章成功');\n          this.$router.push('/admin/artList');\n        } else {\n          const {\n            data: res\n          } = await this.$http.put(`/article/${id}`);\n          if (res.status != 200) return this.$message.error(res.message);\n          this.$message.success('更新文章成功');\n          this.$router.push('/admin/artList');\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AA8CA;AACA;EACAA;EACAC;IACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;QACAT;UAAAU;UAAAC;UAAAC;QAAA;QACAC;UAAAH;UAAAC;UAAAC;QAAA;QACAV;UAAAQ;UAAAC;UAAAC;QAAA,GACA;UAAAE;UAAAH;UAAAC;QAAA;QACAG;UAAAL;UAAAC;UAAAC;QAAA;QACAT;UAAAO;UAAAC;UAAAC;QAAA;MACA;IACA;EACA;EACAI;IACA;IACA;MAAAC;IAAA;IACA;MACA;IACA;EACA;EACAC;IACA;IACA;MACA;QAAArB;MAAA;MACA;MACA;MACA;IACA;IAEA;IACA;MACA;QAAAA;MAAA;MACAsB;MACA;MACA;IACA;IACA;IACAC;MACA;IACA;IACA;IACAC;MACA;QACA;MACA;MACA;QACA;QACA;QACA;MACA;QACA;MACA;IACA;IACA;IACAC;MACA;QACA;UACA;YAAAzB;UAAA;UACA;UACA;UACA;QACA;UACA;YAAAA;UAAA;UACA;UACA;UACA;QACA;MACA;IACA;EACA;AACA","names":["props","data","artInfo","id","title","cid","desc","content","imf","CateList","upUrl","headers","fileList","artInfoRules","required","message","trigger","cide","max","img","created","Authorization","methods","console","cateChange","upChange","artOk"],"sourceRoot":"src/components/article","sources":["AddArt.vue"],"sourcesContent":["<template>\n    <div>\n        <a-card>\n            <h3>{{id? '编辑文章':'新增文章页面'}}</h3>\n            <a-form-model :model=\"artInfo\" ref=\"artInfoRef\" :rules=\"artInfoRules\" :hideRequiredMark=\"true\">\n                <a-form-model-item label=\"文章标题\" prop=\"title\">\n                    <a-input style=\"width:300px\" v-model=\"artInfo.title\"></a-input>\n                </a-form-model-item>\n                <a-form-model-item label=\"文章分类\" prop=\"cid\">\n                    <a-select style=\"width:200px\" v-model=\"artInfo.cid\" placeholder=\"请选择分类\" @change=\"cateChange\">\n                        <a-select-option v-for=\"item in CateList\" :key=\"item.id\" :value=\"item.id\">{{item.name}}</a-select-option>\n                    </a-select>\n                </a-form-model-item>\n                <a-form-model-item label=\"文章描述\" prop=\"desc\">\n                    <a-input type=\"textarea\"></a-input>\n                </a-form-model-item>\n                <a-form-model-item label=\"文章缩略图\" prop=\"img\">\n                    <a-upload\n                    name=\"file\"\n                    :multiple=\"false\"\n                    :action=\"upUrl\"\n                    :headers=\"headers\"\n                    @change=\"upChange\"\n                    listType=\"picture\" \n                    :defaultFileList=\"fileList\"\n                  >\n                    <a-button> <a-icon type=\"upload\" /> 点击上传 </a-button>\n                    <br/>\n                    <template v-if=\"id\">\n                        <img :src=\"artInfo.img\" style=\"width:120px; height:100px\">\n                    </template>\n                  </a-upload>\n                </a-form-model-item>\n                <a-form-model-item label=\"文章内容\" prop=\"content\">\n                    <a-input v-model=\"artInfo.content\"></a-input>\n                </a-form-model-item>\n                <a-form-model-item>\n                    <a-button type=\"danger\" style=\"margin-right:15px\" @click=\"artOk(artInfo.id)\">{{artInfo.id?'更新':'提交'}}</a-button>\n                    <a-button type=\"primary\" @click=\"addCancel\">取消</a-button>\n                </a-form-model-item>\n            </a-form-model>\n        </a-card>\n    </div>\n</template>\n\n<script>\nimport { Url } from '../../plugin/http'\nexport default {\n    props:['id'],\n    data() {\n        return {\n            artInfo:{\n                id:0,\n                title:'',\n                cid:undefined,\n                desc:'',\n                content:'',\n                imf:'',\n            },\n            CateList:[],\n            upUrl: Url + '/upload',\n            headers:{},\n            fileList:[],\n            artInfoRules:{\n                title:[{required:true, message:\"请输入文章标题\", trigger: 'blur'}],\n                cide:[{required:true, message:\"请输入文章分类\", trigger: 'blur'}],\n                desc:[{required:true, message:\"请输入文章描述\", trigger: 'blur'},\n                        {max:120, message:'最多可写120个字符', trigger:'change'}],\n                img:[{required:true, message:\"请选择图片\", trigger: 'blur'}],\n                content:[{required:true, message:\"请输入文章内容\", trigger: 'blur'}],\n            }\n        }\n    },\n    created(){\n        this.getCateList()\n        this.headers = {Authorization: `Bearer ${window.sessionStorage.getItem('token')}`}\n        if (this.id) {\n            this.getArticleInfo(this.id)\n        }\n    },\n    methods:{\n        // 查询文章信息\n        async getArticleInfo(id) {\n            const {data : res} = await this.$http.get(`article/info/${id}`)\n            if (res.status != 200) return this.$message.error(res.message)\n            this.artInfo = res.data\n            this.artInfo.id = res.data.ID\n        },\n\n        // 查询分类列表\n        async getCateList() {\n            const { data:res } = await this.$http.get('category')\n            console.log(res)\n            if (res.status != 200) return this.$message.error(res.message)\n            this.CateList = res.data\n        },\n        // 选择分类\n        cateChange(value){\n            this.artInfo.cid = value\n        },\n        // 上传图片\n        upChange(info) {\n            if (info.file.status !== 'uploading') {\n                // console.log(info.file, info.fileList);\n            }\n            if (info.file.status === 'done') {\n                this.$message.success(`图片上传成功`);\n                const imgUrl =  info.file.response.Url\n                this.artInfo.img = imgUrl\n            } else if (info.file.status === 'error') {\n                this.$message.error(`图片上传失败`);\n            }\n        },\n        // 提交或更新文章\n        artOk(id){\n            this.$refs.artInfoRef.validate(async (valid) => {\n                if (id == 0) {\n                    const {data:res} = await this.$http.post('article/add', this.artInfo)\n                    if (res.status != 200) return this.$message.error(res.message)\n                    this.$message.success('添加文章成功')\n                    this.$router.push('/admin/artList')\n                } else {\n                    const {data:res} = await this.$http.put(`/article/${id}`)\n                    if (res.status != 200) return this.$message.error(res.message)\n                    this.$message.success('更新文章成功')\n                    this.$router.push('/admin/artList')\n                }\n            })\n        }\n    }\n}\n</script>"]},"metadata":{},"sourceType":"module"}