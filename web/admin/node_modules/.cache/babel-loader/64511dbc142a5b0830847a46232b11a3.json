{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport day from 'dayjs';\nconst columns = [{\n  title: 'ID',\n  dataIndex: 'ID',\n  width: '2%',\n  key: 'id',\n  align: 'center'\n}, {\n  title: '创建时间',\n  dataIndex: 'CreatedAt',\n  width: '10%',\n  key: 'CreatedAt',\n  align: 'center',\n  customRender: val => {\n    return val ? day(val).format('YYYY年MM月DD日 HH:mm') : '暂无';\n  }\n}, {\n  title: '评论文章',\n  dataIndex: 'article_title',\n  width: '7%',\n  key: 'article_title',\n  align: 'center'\n}, {\n  title: '评论者',\n  dataIndex: 'username',\n  width: '7%',\n  key: 'username',\n  align: 'center'\n}, {\n  title: '评论内容',\n  dataIndex: 'content',\n  width: '20%',\n  key: 'content',\n  align: 'center'\n}, {\n  title: '评论状态',\n  dataIndex: 'status',\n  width: '7%',\n  key: 'status',\n  align: 'center',\n  scopedSlots: {\n    customRender: 'status'\n  }\n}, {\n  title: '操作',\n  width: '20%',\n  key: 'action',\n  align: 'center',\n  scopedSlots: {\n    customRender: 'action'\n  }\n}];\nexport default {\n  data() {\n    return {\n      commentList: [],\n      commentInfo: {\n        status: 1\n      },\n      pagination: {\n        pageSizeOptions: ['5', '10', '20'],\n        pageSize: 5,\n        total: 0,\n        showSizeChanger: true,\n        showTotal: total => `共${total}条`\n      },\n      columns,\n      queryParam: {\n        pagesize: 10,\n        pagenum: 1\n      }\n    };\n  },\n  created() {\n    this.getCommentList();\n  },\n  methods: {\n    // 获取评论列表\n    async getCommentList() {\n      const {\n        data: res\n      } = await this.$http.get('comment/list', {\n        params: {\n          pagesize: this.queryParam.pagesize,\n          pagenum: this.queryParam.pagenum\n        }\n      });\n      if (res.status !== 200) {\n        if (res.status === 1004 || 1005 || 1006 || 1007) {\n          window.sessionStorage.clear();\n          this.$router.push('/login');\n        }\n        this.$message.error(res.message);\n      }\n      this.commentList = res.data;\n      this.pagination.total = res.total;\n    },\n    // 更改分页\n    handleTableChange(pagination, filters, sorter) {\n      var pager = {\n        ...this.pagination\n      };\n      pager.current = pagination.current;\n      pager.pageSize = pagination.pageSize;\n      this.queryParam.pagesize = pagination.pageSize;\n      this.queryParam.pagenum = pagination.current;\n      if (pagination.pageSize !== this.pagination.pageSize) {\n        this.queryParam.pagenum = 1;\n        pager.current = 1;\n      }\n      this.pagination = pager;\n      this.getCommentList();\n    },\n    // 通过审核\n    commentCheck(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '要通过审核吗？',\n        onOk: async () => {\n          const {\n            data: res_status\n          } = await this.$http.get(`comment/info/${id}`);\n          if (res_status.data.status === 1) return this.$message.error('该评论已处于显示状态，无需审核');\n          const {\n            data: res\n          } = await this.$http.put(`checkcomment/${id}`, {\n            status: 1\n          });\n          if (res.status != 200) return this.$message.error(res.message);\n          this.$message.success('审核成功');\n          this.getCommentList();\n        },\n        onCancel: () => {\n          this.$message.info('已取消');\n        }\n      });\n    },\n    // 撤下评论\n    commentUncheck(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '要撤下该评论吗？',\n        onOk: async () => {\n          const {\n            data: res_status\n          } = await this.$http.get(`comment/info/${id}`);\n          if (res_status.data.status === 2) return this.$message.error('该评论已处于未审核状态，无需撤下');\n          const {\n            data: res\n          } = await this.$http.put(`uncheckcomment/${id}`, {\n            status: 2\n          });\n          if (res.status != 200) return this.$message.error(res.message);\n          this.$message.success('评论已撤下');\n          this.getCommentList();\n        },\n        onCancel: () => {\n          this.$message.info('已取消');\n        }\n      });\n    },\n    // 删除评论\n    deleteComment(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '要删除吗？',\n        onOk: async () => {\n          const {\n            data: res\n          } = await this.$http.delete(`delcomment/${id}`);\n          if (res.status != 200) return this.$message.error(res.message);\n          this.$message.success('删除成功');\n          this.getCommentList();\n        },\n        onCancel: () => {\n          this.$message.info('已取消');\n        }\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AAuCA;AACA,iBACA;EACAA;EACAC;EACAC;EACAC;EACAC;AACA,GACA;EACAJ;EACAC;EACAC;EACAC;EACAC;EACAC;IACA;EACA;AACA,GACA;EACAL;EACAC;EACAC;EACAC;EACAC;AACA,GACA;EACAJ;EACAC;EACAC;EACAC;EACAC;AACA,GACA;EACAJ;EACAC;EACAC;EACAC;EACAC;AACA,GACA;EACAJ;EACAC;EACAC;EACAC;EACAC;EACAE;IAAAD;EAAA;AACA,GACA;EACAL;EACAE;EACAC;EACAC;EACAE;IAAAD;EAAA;AACA,EACA;AACA;EACAE;IACA;MACAC;MACAC;QACAC;MACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;QACAC;QACAC;MACA;IACA;EACA;EACAC;IACA;EACA;EACAC;IACA;IACA;MACA;QAAAf;MAAA;QACAgB;UACAJ;UACAC;QACA;MACA;MAEA;QACA;UACAI;UACA;QACA;QACA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;QAAA;MAAA;MACAC;MACAA;MACA;MACA;MAEA;QACA;QACAA;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;QACA3B;QACA4B;QACAC;UACA;YAAAtB;UAAA;UACA;UACA;YAAAA;UAAA;YACAG;UACA;UACA;UACA;UACA;QACA;QACAoB;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;QACA/B;QACA4B;QACAC;UACA;YAAAtB;UAAA;UACA;UACA;YAAAA;UAAA;YACAG;UACA;UACA;UACA;UACA;QACA;QACAoB;UACA;QACA;MACA;IACA;IAEA;IACAE;MACA;QACAhC;QACA4B;QACAC;UACA;YAAAtB;UAAA;UACA;UACA;UACA;QACA;QACAuB;UACA;QACA;MACA;IACA;EACA;AACA","names":["title","dataIndex","width","key","align","customRender","scopedSlots","data","commentList","commentInfo","status","pagination","pageSizeOptions","pageSize","total","showSizeChanger","showTotal","columns","queryParam","pagesize","pagenum","created","methods","params","window","handleTableChange","pager","commentCheck","content","onOk","onCancel","commentUncheck","deleteComment"],"sourceRoot":"src/components/comment","sources":["commentList.vue"],"sourcesContent":["<template>\n  <div>\n    <a-card>\n      <a-table\n        rowKey=\"ID\"\n        :columns=\"columns\"\n        :pagination=\"pagination\"\n        :dataSource=\"commentList\"\n        bordered\n        @change=\"handleTableChange\"\n      >\n        <span slot=\"status\" slot-scope=\"data\">{{ data == 1 ? '审核通过' : '未审核' }}</span>\n        <template slot=\"action\" slot-scope=\"data\">\n          <div class=\"actionSlot\">\n            <a-button\n              type=\"primary\"\n              icon=\"edit\"\n              style=\"margin-right: 15px\"\n              @click=\"commentCheck(data.ID)\"\n            >通过审核</a-button>\n            <a-button\n              type=\"primary\"\n              icon=\"info\"\n              style=\"margin-right: 15px\"\n              @click=\"commentUncheck(data.ID)\"\n            >撤下评论</a-button>\n            <a-button\n              type=\"danger\"\n              icon=\"delete\"\n              style=\"margin-right: 15px\"\n              @click=\"deleteComment(data.ID)\"\n            >删除</a-button>\n          </div>\n        </template>\n      </a-table>\n    </a-card>\n  </div>\n</template>\n<script>\nimport day from 'dayjs'\nconst columns = [\n  {\n    title: 'ID',\n    dataIndex: 'ID',\n    width: '2%',\n    key: 'id',\n    align: 'center',\n  },\n  {\n    title: '创建时间',\n    dataIndex: 'CreatedAt',\n    width: '10%',\n    key: 'CreatedAt',\n    align: 'center',\n    customRender: (val) => {\n      return val ? day(val).format('YYYY年MM月DD日 HH:mm') : '暂无'\n    },\n  },\n  {\n    title: '评论文章',\n    dataIndex: 'article_title',\n    width: '7%',\n    key: 'article_title',\n    align: 'center',\n  },\n  {\n    title: '评论者',\n    dataIndex: 'username',\n    width: '7%',\n    key: 'username',\n    align: 'center',\n  },\n  {\n    title: '评论内容',\n    dataIndex: 'content',\n    width: '20%',\n    key: 'content',\n    align: 'center',\n  },\n  {\n    title: '评论状态',\n    dataIndex: 'status',\n    width: '7%',\n    key: 'status',\n    align: 'center',\n    scopedSlots: { customRender: 'status' },\n  },\n  {\n    title: '操作',\n    width: '20%',\n    key: 'action',\n    align: 'center',\n    scopedSlots: { customRender: 'action' },\n  },\n]\nexport default {\n  data() {\n    return {\n      commentList: [],\n      commentInfo: {\n        status: 1,\n      },\n      pagination: {\n        pageSizeOptions: ['5', '10', '20'],\n        pageSize: 5,\n        total: 0,\n        showSizeChanger: true,\n        showTotal: (total) => `共${total}条`,\n      },\n      columns,\n      queryParam: {\n        pagesize: 10,\n        pagenum: 1,\n      },\n    }\n  },\n  created() {\n    this.getCommentList()\n  },\n  methods: {\n    // 获取评论列表\n    async getCommentList() {\n      const { data: res } = await this.$http.get('comment/list', {\n        params: {\n          pagesize: this.queryParam.pagesize,\n          pagenum: this.queryParam.pagenum,\n        },\n      })\n\n      if (res.status !== 200) {\n        if (res.status === 1004 || 1005 || 1006 || 1007) {\n          window.sessionStorage.clear()\n          this.$router.push('/login')\n        }\n        this.$message.error(res.message)\n      }\n      this.commentList = res.data\n      this.pagination.total = res.total\n    },\n\n    // 更改分页\n    handleTableChange(pagination, filters, sorter) {\n      var pager = { ...this.pagination }\n      pager.current = pagination.current\n      pager.pageSize = pagination.pageSize\n      this.queryParam.pagesize = pagination.pageSize\n      this.queryParam.pagenum = pagination.current\n\n      if (pagination.pageSize !== this.pagination.pageSize) {\n        this.queryParam.pagenum = 1\n        pager.current = 1\n      }\n      this.pagination = pager\n      this.getCommentList()\n    },\n\n    // 通过审核\n    commentCheck(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '要通过审核吗？',\n        onOk: async () => {\n          const { data: res_status } = await this.$http.get(`comment/info/${id}`)\n          if (res_status.data.status === 1) return this.$message.error('该评论已处于显示状态，无需审核')\n          const { data: res } = await this.$http.put(`checkcomment/${id}`, {\n            status: 1,\n          })\n          if (res.status != 200) return this.$message.error(res.message)\n          this.$message.success('审核成功')\n          this.getCommentList()\n        },\n        onCancel: () => {\n          this.$message.info('已取消')\n        },\n      })\n    },\n\n    // 撤下评论\n    commentUncheck(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '要撤下该评论吗？',\n        onOk: async () => {\n          const { data: res_status } = await this.$http.get(`comment/info/${id}`)\n          if (res_status.data.status === 2) return this.$message.error('该评论已处于未审核状态，无需撤下')\n          const { data: res } = await this.$http.put(`uncheckcomment/${id}`, {\n            status: 2,\n          })\n          if (res.status != 200) return this.$message.error(res.message)\n          this.$message.success('评论已撤下')\n          this.getCommentList()\n        },\n        onCancel: () => {\n          this.$message.info('已取消')\n        },\n      })\n    },\n\n    // 删除评论\n    deleteComment(id) {\n      this.$confirm({\n        title: '提示：请再次确认',\n        content: '要删除吗？',\n        onOk: async () => {\n          const { data: res } = await this.$http.delete(`delcomment/${id}`)\n          if (res.status != 200) return this.$message.error(res.message)\n          this.$message.success('删除成功')\n          this.getCommentList()\n        },\n        onCancel: () => {\n          this.$message.info('已取消')\n        },\n      })\n    },\n  },\n}\n</script>\n<style lang=\"\">\n</style>\n"]},"metadata":{},"sourceType":"module"}